<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bài tập 02 - Form đăng ký</title>
  <style>
    :root{ --brand:#0b5ed7; --border:#e5e7eb; --muted:#6b7280; --bg:#f5f7fb; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: Arial, Helvetica, sans-serif; background:var(--bg); }
    .wrap{ max-width: 900px; margin: 0 auto; padding: 18px; }
    .menu{
      background: var(--brand); border-radius: 12px; overflow:hidden; margin: 18px 0;
    }
    .menu a{ color:#fff; text-decoration:none; font-weight:700; padding:12px 14px; display:inline-block; }
    .menu a:hover{ background:#084298; }

    .card{
      background:#fff; border:1px solid var(--border); border-radius:12px;
      padding: 18px; box-shadow: 0 6px 16px rgba(0,0,0,.05);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 12px;
    }
    .field{ display:flex; flex-direction:column; gap:6px; }
    label{ font-weight:700; }
    input[type="text"], input[type="email"], input[type="password"]{
      padding: 12px;
      border:1px solid var(--border);
      border-radius: 10px;
      font-size: 16px;
      outline:none;
    }
    input:focus{ border-color: var(--brand); }

    .row{ margin-top: 10px; display:flex; align-items:center; gap: 10px; }
    .error{ color:#b91c1c; font-size: 13px; min-height: 16px; }
    .btn{
      background: var(--brand);
      color:#fff;
      border:0;
      padding: 12px 14px;
      border-radius: 10px;
      font-weight: 800;
      cursor:pointer;
    }
    .btn:hover{ background:#084298; }
    .success{
      margin-top: 12px;
      padding: 12px;
      border: 1px solid #22c55e;
      color: #166534;
      background: #f0fdf4;
      border-radius: 12px;
      display:none;
    }
    .muted{ color: var(--muted); }
    code{ background:#f3f4f6; padding:2px 6px; border-radius:6px; }

    @media (max-width: 720px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="menu">
      <a href="index.html">Trang chủ</a>
      <a href="baitap01.html">Bài 01</a>
      <a href="baitap02.html">Bài 02</a>
      <a href="baitap03.html">Bài 03</a>
      <a href="baitap14.html">Bài 14</a>
    </div>

    <section class="card">
      <h1 style="margin:0;">Bài tập 02: Form đăng ký + Validate + LocalStorage</h1>
      <p class="muted" style="margin-top:6px;">
        Mật khẩu yêu cầu: <strong>tối thiểu 8 ký tự</strong>, có <strong>chữ hoa</strong>, <strong>chữ thường</strong>, <strong>số</strong>.
      </p>

      <form id="form" novalidate>
        <div class="grid">
          <div class="field">
            <label for="name">Tên</label>
            <input id="name" type="text" placeholder="Nguyễn Văn A" autocomplete="name" />
            <div class="error" id="eName"></div>
          </div>

          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="a@gmail.com" autocomplete="email" />
            <div class="error" id="eEmail"></div>
          </div>

          <div class="field">
            <label for="pass">Mật khẩu</label>
            <input id="pass" type="password" placeholder="********" autocomplete="new-password" />
            <div class="error" id="ePass"></div>
          </div>

          <div class="field">
            <label>Điều khoản</label>
            <div class="row">
              <input id="agree" type="checkbox" />
              <span>Tôi đồng ý điều khoản</span>
            </div>
            <div class="error" id="eAgree"></div>
          </div>
        </div>

        <div class="row" style="margin-top:14px;">
          <button class="btn" type="submit">Đăng ký</button>
          <button class="btn" type="button" id="btnLoad" style="background:#111827;">Xem dữ liệu đã lưu</button>
          <button class="btn" type="button" id="btnClear" style="background:#ef4444;">Xóa LocalStorage</button>
        </div>

        <div class="success" id="ok"></div>

        <div style="margin-top:16px; border-top:1px solid var(--border); padding-top:12px;">
          <h2 style="margin:0 0 8px 0;">Giải thích logic tư duy</h2>
          <ul style="margin:0;">
            <li><strong>Xử lý submit</strong>: dùng <code>e.preventDefault()</code> để không reload trang, rồi validate từng trường.</li>
            <li><strong>Validate</strong>: regex email đơn giản; regex password bắt buộc có hoa/thường/số và >= 8 ký tự.</li>
            <li><strong>Bảo mật dữ liệu cục bộ</strong>: LocalStorage <em>không an toàn</em> cho mật khẩu ⇒ chỉ lưu <strong>tên + email</strong>, không lưu password.</li>
            <li><strong>UX</strong>: hiển thị lỗi ngay dưới field; thông báo thành công sau khi lưu.</li>
          </ul>
        </div>
      </form>
    </section>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const form = $("form");
    const ok = $("ok");

    const validators = {
      email: (v) => /^\S+@\S+\.\S+$/.test(v),
      password: (v) => /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(v)
    };

    function setError(id, msg){
      $(id).textContent = msg || "";
    }

    function clearAllErrors(){
      setError("eName", "");
      setError("eEmail", "");
      setError("ePass", "");
      setError("eAgree", "");
    }

    function showOk(msg){
      ok.style.display = "block";
      ok.textContent = msg;
    }

    function hideOk(){
      ok.style.display = "none";
      ok.textContent = "";
    }

    $("form").addEventListener("submit", (e) => {
      e.preventDefault();
      hideOk();
      clearAllErrors();

      const name = $("name").value.trim();
      const email = $("email").value.trim();
      const pass = $("pass").value;
      const agree = $("agree").checked;

      let valid = true;

      if (!name){
        setError("eName", "Tên không được để trống.");
        valid = false;
      }

      if (!validators.email(email)){
        setError("eEmail", "Email không hợp lệ (ví dụ: a@gmail.com).");
        valid = false;
      }

      if (!validators.password(pass)){
        setError("ePass", "Mật khẩu >= 8 ký tự và có chữ hoa, chữ thường, số.");
        valid = false;
      }

      if (!agree){
        setError("eAgree", "Bạn phải đồng ý điều khoản.");
        valid = false;
      }

      if (!valid) return;

      // Bảo mật cục bộ: KHÔNG lưu password
      const user = { name, email, createdAt: new Date().toISOString() };
      localStorage.setItem("registered_user", JSON.stringify(user));

      $("form").reset();
      showOk("Đăng ký thành công! Đã lưu (name + email) vào LocalStorage với key: registered_user.");
    });

    $("btnLoad").addEventListener("click", () => {
      hideOk();
      const raw = localStorage.getItem("registered_user");
      if (!raw){
        showOk("Chưa có dữ liệu trong LocalStorage.");
        return;
      }
      try{
        const user = JSON.parse(raw);
        showOk("Dữ liệu đã lưu: " + JSON.stringify(user, null, 2));
      }catch(err){
        showOk("Dữ liệu LocalStorage bị lỗi JSON.");
      }
    });

    $("btnClear").addEventListener("click", () => {
      localStorage.removeItem("registered_user");
      showOk("Đã xóa key registered_user trong LocalStorage.");
    });
  </script>
</body>
</html>
